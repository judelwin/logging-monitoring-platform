{
  "title": "Logging & Monitoring Platform",
  "tags": ["logging", "redis-streams", "postgres"],
  "timezone": "browser",
  "schemaVersion": 27,
  "version": 1,
  "refresh": "10s",
  "panels": [
    {
      "id": 1,
      "title": "Logs Per Second (Ingestion Rate)",
      "type": "graph",
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 0,
        "y": 0
      },
      "targets": [
        {
          "expr": "rate(logs_published_total[1m])",
          "legendFormat": "Published (Producer)",
          "refId": "A",
          "datasource": "Prometheus"
        },
        {
          "expr": "rate(logs_processed_total[1m])",
          "legendFormat": "Processed (Processor)",
          "refId": "B",
          "datasource": "Prometheus"
        }
      ],
      "yaxes": [
        {
          "format": "ops",
          "label": "Logs/sec"
        },
        {
          "format": "short"
        }
      ],
      "xaxis": {
        "mode": "time"
      },
      "legend": {
        "show": true,
        "values": true,
        "current": true
      }
    },
    {
      "id": 2,
      "title": "Stream Lag (Pending Messages)",
      "type": "graph",
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 12,
        "y": 0
      },
      "targets": [
        {
          "expr": "logs_stream_lag",
          "legendFormat": "Consumer: {{consumer}}",
          "refId": "A",
          "datasource": "Prometheus"
        }
      ],
      "yaxes": [
        {
          "format": "short",
          "label": "Pending Messages"
        },
        {
          "format": "short"
        }
      ],
      "xaxis": {
        "mode": "time"
      },
      "legend": {
        "show": true,
        "values": true,
        "current": true
      },
      "alert": {
        "conditions": [
          {
            "evaluator": {
              "params": [100],
              "type": "gt"
            },
            "operator": {
              "type": "and"
            },
            "query": {
              "params": ["A", "5m", "now"]
            },
            "reducer": {
              "params": [],
              "type": "last"
            },
            "type": "query"
          }
        ],
        "executionErrorState": "alerting",
        "for": "5m",
        "frequency": "10s",
        "name": "High Stream Lag Alert"
      }
    },
    {
      "id": 3,
      "title": "Database Write Latency",
      "type": "graph",
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 0,
        "y": 8
      },
      "targets": [
        {
          "expr": "histogram_quantile(0.50, rate(logs_db_write_latency_seconds_bucket[1m]))",
          "legendFormat": "p50",
          "refId": "A",
          "datasource": "Prometheus"
        },
        {
          "expr": "histogram_quantile(0.95, rate(logs_db_write_latency_seconds_bucket[1m]))",
          "legendFormat": "p95",
          "refId": "B",
          "datasource": "Prometheus"
        },
        {
          "expr": "histogram_quantile(0.99, rate(logs_db_write_latency_seconds_bucket[1m]))",
          "legendFormat": "p99",
          "refId": "C",
          "datasource": "Prometheus"
        }
      ],
      "yaxes": [
        {
          "format": "s",
          "label": "Latency"
        },
        {
          "format": "short"
        }
      ],
      "xaxis": {
        "mode": "time"
      },
      "legend": {
        "show": true,
        "values": true,
        "current": true
      }
    },
    {
      "id": 4,
      "title": "Publish Latency (Producer)",
      "type": "graph",
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 12,
        "y": 8
      },
      "targets": [
        {
          "expr": "histogram_quantile(0.50, rate(logs_publish_latency_seconds_bucket[1m]))",
          "legendFormat": "p50",
          "refId": "A",
          "datasource": "Prometheus"
        },
        {
          "expr": "histogram_quantile(0.95, rate(logs_publish_latency_seconds_bucket[1m]))",
          "legendFormat": "p95",
          "refId": "B",
          "datasource": "Prometheus"
        },
        {
          "expr": "histogram_quantile(0.99, rate(logs_publish_latency_seconds_bucket[1m]))",
          "legendFormat": "p99",
          "refId": "C",
          "datasource": "Prometheus"
        }
      ],
      "yaxes": [
        {
          "format": "s",
          "label": "Latency"
        },
        {
          "format": "short"
        }
      ],
      "xaxis": {
        "mode": "time"
      },
      "legend": {
        "show": true,
        "values": true,
        "current": true
      }
    }
  ],
  "time": {
    "from": "now-15m",
    "to": "now"
  },
  "timepicker": {
    "refresh_intervals": ["5s", "10s", "30s", "1m", "5m", "15m", "30m", "1h", "2h", "1d"]
  }
}
